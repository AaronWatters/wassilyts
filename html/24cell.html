
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>wassilyjs Library Demo</title>
</head>
<body>
<h1>24-cell test page</h1>


<div id="info">info here...</div>

<!-- add two sliders with range -7..7 for eye and focus -->
<div>
  <label for="eyeX">Eye X:</label>
  <input type="range" id="eyeX" name="eyeX" min="-7" max="7" value="-1" step="0.1">
  <span id="eyeXValue">-1</span>
</div>
<div>
  <label for="eyeY">Eye Y:</label>
  <input type="range" id="eyeY" name="eyeY" min="-7" max="7" value="-1" step="0.1">
  <span id="eyeYValue">-1</span>
</div>

<div id="output"></div>

<script type="module">
  import { 
      name,
      diagram,
      drawOn,
      tsvector,
      conveniences
  } from '../src/index.ts';


function rotate4d(a, b, c) {
    // 4d rotation matrix
    const R = [
        [1, 0, 0, 0],
        [0, Math.cos(a), 0, -Math.sin(a)],
        [0, 0, 1, 0],
        [0, Math.sin(a), 0, Math.cos(a)]
    ];
    const S = [
        [Math.cos(b), 0, 0, -Math.sin(b)],
        [0, 1, 0, 0],
        [0, 0, 1, 0],
        [Math.sin(b), 0, 0, Math.cos(b)]
    ];
    const T = [
        [1, 0, 0, 0],
        [0, 1, 0, 0],
        [0, 0, Math.cos(c), -Math.sin(b)],
        [0, 0, Math.sin(b), Math.cos(c)],
    ];
    const M = tsvector.MMProduct(R, S);
    return tsvector.MMProduct(M, T);
};

function pr3d(v) {
    // 4d to 3d projection
    return [v[0], v[1], v[2]];
};

function shrink_to_center(v1, v2, v3) {
  const center = tsvector.vScale(1/3.0, tsvector.vAdd(v1, tsvector.vAdd(v2, v3)));
  return [tsvector.vScale(0.5, tsvector.vAdd(v1, center)),
          tsvector.vScale(0.5, tsvector.vAdd(v2, center)),
          tsvector.vScale(0.5, tsvector.vAdd(v3, center))];
}

function rotate_project_faces(faces, a, b, c) {
    // rotate faces in 4d and center them in a 3d cube of shape (width, width, width)
    const M = rotate4d(a, b, c);
    function rp(vertex) {
      const r = tsvector.MvProduct(M, vertex);
      return pr3d(r);
    }
    const triples = [];
    for (let i = 0; i < faces.length; i++) {
      const [a4, b4, c4] = faces[i];
      const a4r = rp(a4);
      const b4r = rp(b4);
      const c4r = rp(c4);
      const triple = shrink_to_center(a4r, b4r, c4r);
      triples.push(triple);
    }
    return triples;
}

  const faces = [
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, -1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, 1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, -1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, 1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [-1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, -1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, 1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, -1.0]],
  [[-1.0, -1.0, 0.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, 1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, -1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, 1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, -1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, 1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [-1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, -1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, 1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, -1.0]],
  [[-1.0, 1.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, 1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, -1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, 1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, -1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, 1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0]],
  [[1.0, -1.0, 0.0, 0.0], [1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0]],
  [[1.0, -1.0, 0.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, -1.0]],
  [[1.0, -1.0, 0.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, 1.0]],
  [[1.0, -1.0, 0.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, -1.0]],
  [[1.0, -1.0, 0.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, 1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, -1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, 1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, -1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, 1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0]],
  [[1.0, 1.0, 0.0, 0.0], [1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0]],
  [[1.0, 1.0, 0.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, -1.0]],
  [[1.0, 1.0, 0.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, 1.0]],
  [[1.0, 1.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, -1.0]],
  [[1.0, 1.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, 1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [-1.0, 0.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, 0.0, -1.0, -1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, 0.0, -1.0, 1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 0.0, -1.0, -1.0]],
  [[-1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 0.0, -1.0, 1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [-1.0, 0.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, 0.0, 1.0, -1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, 0.0, 1.0, 1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 0.0, 1.0, -1.0]],
  [[-1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 0.0, 1.0, 1.0]],
  [[1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[1.0, 0.0, -1.0, 0.0], [1.0, 0.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, 0.0, -1.0, -1.0]],
  [[1.0, 0.0, -1.0, 0.0], [0.0, -1.0, -1.0, 0.0], [0.0, 0.0, -1.0, 1.0]],
  [[1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 0.0, -1.0, -1.0]],
  [[1.0, 0.0, -1.0, 0.0], [0.0, 1.0, -1.0, 0.0], [0.0, 0.0, -1.0, 1.0]],
  [[1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[1.0, 0.0, 1.0, 0.0], [1.0, 0.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, 0.0, 1.0, -1.0]],
  [[1.0, 0.0, 1.0, 0.0], [0.0, -1.0, 1.0, 0.0], [0.0, 0.0, 1.0, 1.0]],
  [[1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 0.0, 1.0, -1.0]],
  [[1.0, 0.0, 1.0, 0.0], [0.0, 1.0, 1.0, 0.0], [0.0, 0.0, 1.0, 1.0]],
  [[-1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[-1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[-1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[-1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[-1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[-1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[-1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[-1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[1.0, 0.0, 0.0, -1.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[1.0, 0.0, 0.0, -1.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[1.0, 0.0, 0.0, 1.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[1.0, 0.0, 0.0, 1.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[0.0, -1.0, -1.0, 0.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[0.0, -1.0, 1.0, 0.0], [0.0, -1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]],
  [[0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, -1.0, -1.0]],
  [[0.0, 1.0, -1.0, 0.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, -1.0, 1.0]],
  [[0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, -1.0], [0.0, 0.0, 1.0, -1.0]],
  [[0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, 1.0], [0.0, 0.0, 1.0, 1.0]]];

  console.log("Hello from wassilyjs Library!");
  console.log("The name of the library is: " + name);

  const output = document.getElementById('output');
  const info = document.getElementById('info');

  //const d = new diagram.Diagram(output, 520, 600);
  const size = 900
  const frame0 = drawOn(output, size, size);
  // thick lines
  frame0.linedWidth(10);
  debugger;
  // make a subframe
  const fromMin = [0,0];
  const fromMax = [size, size];
  const toMin = [-3,-3];
  const toMax = [3,3];
  const frame1 = frame0.regionFrame(fromMin, fromMax, toMin, toMax);
  //const eye = [0, 0, 0];
  const eye = [-3, 0, 0];
  const focus = [0, 0, 0];
  const frame3d = frame1.frame3d(eye, focus);
  console.log("frame3d: ", frame3d);

  function tricolor(a, b, c) {
    const ab = tsvector.vSub(a, b);
    const ac = tsvector.vSub(a, c);
    const normal = tsvector.vCross(ab, ac);
    return conveniences.rgb(normal);
  }

    function drawFaces(faces, a, b, c) {
      // draw the faces of the 24-cell
      frame3d.clear();
      const projectedFaces = rotate_project_faces(faces, a, b, c);
      const limit = 0;  
      var count = 0;
      for (var i=0; i < projectedFaces.length; i++) {
        const points = projectedFaces[i];
        const color = tricolor(...points);
        frame3d.poly(points).colored(color).filled();
        if (limit && count > limit) {
          break;
        }
        count++;
      }
    };

    drawFaces(faces, 1, 2, 3);

  // draw triangles for the faces
  // slider dom objects
  const eyeXSlider = document.getElementById('eyeX');
  const eyeYSlider = document.getElementById('eyeY');
  const eyeXValue = document.getElementById('eyeXValue');
  const eyeYValue = document.getElementById('eyeYValue');
  // update the frame when sliders change
  function updateFrame() {
    const eyeX = parseFloat(eyeXSlider.value);
    const eyeY = parseFloat(eyeYSlider.value);
    eyeXValue.textContent = eyeX;
    eyeYValue.textContent = eyeY;
    drawFaces(faces, eyeX, eyeY, eyeX+eyeY);
  };
  // add event listeners to sliders
  eyeXSlider.addEventListener('input', updateFrame);
  eyeYSlider.addEventListener('input', updateFrame);

  frame3d.orbit();
</script>
</body>
</html>